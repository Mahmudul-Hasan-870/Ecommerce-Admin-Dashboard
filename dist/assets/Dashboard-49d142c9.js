import{d as U,o as n,c as l,k as e,D as B,I as K,J as P,K as R,p as h,u as s,j as p,F as j,v as V,a as g,l as z,h as L,H as Q,r as H,w as W,g as w,i as X,s as Y}from"./vendor-513bb039.js";import{a as y,u as Z}from"./index-713483bf.js";import{u as ee}from"./settings-a6e2b395.js";import{u as te,_ as re}from"./PermissionDialog-ca0538f2.js";import{s as se}from"./confirm-78191804.js";import{_ as oe}from"./Avatar-68d237c2.js";import{i as ae}from"./theme-d3f726f4.js";import{r as ie,a as ne,b as ce}from"./XMarkIcon-f0b84fb4.js";import{r as de,a as le,b as ue}from"./UsersIcon-ae56d0fd.js";const he=U("notifications",{state:()=>({notifications:[],unreadCount:0,loading:!1,error:null}),getters:{lowStockNotifications:r=>r.notifications.filter(t=>t.type==="low_stock"),newOrderNotifications:r=>r.notifications.filter(t=>t.type==="new_order"),highPriorityNotifications:r=>r.notifications.filter(t=>t.priority==="high")},actions:{async fetchNotifications(){var r,t;this.loading=!0,this.error=null;try{const c=await y.get("/notifications");return this.notifications=c.data.notifications,this.unreadCount=c.data.unreadCount,{success:!0}}catch(c){return this.error=((t=(r=c.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to fetch notifications",{success:!1,error:this.error}}finally{this.loading=!1}},async markAsRead(r){var t,c;try{const i=this.notifications.find(u=>u.id===r);return i?await y.patch(`/notifications/${r}/read`,{type:i.type,relatedId:i.id,relatedModel:i.type==="low_stock"?"Product":"Order"}):await y.patch(`/notifications/${r}/read`),this.notifications=this.notifications.filter(u=>u.id!==r),this.unreadCount=Math.max(0,this.unreadCount-1),{success:!0}}catch(i){return this.error=((c=(t=i.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to mark notification as read",{success:!1,error:this.error}}},async markAllAsRead(){var r,t;try{return await y.patch("/notifications/mark-all-read",{notifications:this.notifications}),this.notifications=[],this.unreadCount=0,{success:!0}}catch(c){return this.error=((t=(r=c.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to mark all notifications as read",{success:!1,error:this.error}}}}});function me(r,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"})])}function ge(r,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function fe(r,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12a7.5 7.5 0 0 0 15 0m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m16.5 0H21m-1.5 0H12m-8.457 3.077 1.41-.513m14.095-5.13 1.41-.513M5.106 17.785l1.15-.964m11.49-9.642 1.149-.964M7.501 19.795l.75-1.3m7.5-12.99.75-1.3m-6.063 16.658.26-1.477m2.605-14.772.26-1.477m0 17.726-.26-1.477M10.698 4.614l-.26-1.477M16.5 19.794l-.75-1.299M7.5 4.205 12 12m6.894 5.785-1.149-.964M6.256 7.178l-1.15-.964m15.352 8.864-1.41-.513M4.954 9.435l-1.41-.514M12.002 12l-3.75 6.495"})])}function pe(r,t){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})])}const ye={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},ke={class:"fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 shadow-lg"},xe={class:"flex flex-col justify-center h-20 px-6 border-b border-gray-200 dark:border-gray-700"},ve={class:"text-xl font-bold text-gray-900 dark:text-white"},we={key:0,class:"text-xs text-gray-600 dark:text-gray-400 mt-1 leading-tight",style:{"font-size":"0.625rem"}},_e={class:"mt-6 px-3"},be={class:"space-y-1"},Ce={class:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},$e={class:"pl-64"},Me={class:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700"},Ae={class:"flex items-center justify-between px-6 py-4"},Ne={class:"text-2xl font-bold text-gray-900 dark:text-white"},De={class:"flex items-center space-x-4"},Se={class:"relative"},Be={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"},Pe={key:0,class:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700"},Re={key:0,class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},je={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700"},Ve=["onClick"],ze={class:"flex items-start"},Le={class:"flex-shrink-0"},He={class:"ml-3 flex-1"},Fe={class:"text-sm font-medium text-gray-900 dark:text-white"},Oe={class:"text-sm text-gray-500 dark:text-gray-400"},Te={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},qe=["onClick"],Ee={class:"relative"},Ge={class:"text-gray-700 dark:text-gray-300"},Ie={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-200 dark:border-gray-700"},Je={class:"p-6"},ot={__name:"Dashboard",setup(r){const t=Q(),c=Z(),i=he(),u=ee(),{showPermissionDialog:F,permissionDialogData:k,checkPermission:Ue,closePermissionDialog:Ke,handleGoBack:O,handleContactAdmin:T}=te(),x=B(!1),f=B(!1),_=[{name:"Dashboard",href:"/",icon:pe,permission:"dashboard"},{name:"Products",href:"/products",icon:de,permission:"products"},{name:"Categories",href:"/categories",icon:ne,permission:"categories"},{name:"Banners",href:"/banners",icon:ce,permission:"banners"},{name:"Orders",href:"/orders",icon:le,permission:"orders"},{name:"Customers",href:"/customers",icon:ue,permission:"customers"},{name:"Settings",href:"/settings",icon:fe,permission:"settings"}],q=K(()=>{const o=_.find(d=>d.href===t.currentRoute.value.path||t.currentRoute.value.path==="/"&&d.href==="/");return o?o.name:"Dashboard"}),E=o=>{const d=new Date(o),m=Math.floor((new Date-d)/(1e3*60));return m<1?"Just now":m<60?`${m}m ago`:m<1440?`${Math.floor(m/60)}h ago`:d.toLocaleDateString()},G=o=>{o.type==="low_stock"?t.push("/products"):o.type==="new_order"&&t.push("/orders"),b(o.id)},b=async o=>{await i.markAsRead(o)},I=async()=>{await i.markAllAsRead()},C=async()=>{se(async()=>{await c.logout(),t.push("/login")})},J=o=>!0;let v;P(async()=>{await c.refreshUserPermissions(),await Promise.all([i.fetchNotifications(),u.fetchSettings()]),ae(u.settings),v=setInterval(async()=>{await i.fetchNotifications()},3e4)}),R(()=>{v&&clearInterval(v)});const $=o=>{o.target.closest(".relative")||(f.value=!1)};return P(()=>{document.addEventListener("click",$)}),R(()=>{document.removeEventListener("click",$)}),(o,d)=>{var A,N,D;const M=H("router-link"),m=H("router-view");return n(),l("div",ye,[e("div",ke,[e("div",xe,[e("h1",ve,h(s(u).settings.siteName),1),s(u).settings.siteDescription?(n(),l("p",we,h(s(u).settings.siteDescription),1)):p("",!0)]),e("nav",_e,[e("div",be,[(n(),l(j,null,V(_,a=>g(M,{key:a.name,to:a.href,onClick:S=>J(),class:w([o.$route.path===a.href||o.$route.path==="/"&&a.href==="/"?"bg-primary-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-black dark:hover:text-white","group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200"])},{default:W(()=>[(n(),L(X(a.icon),{class:w([o.$route.path===a.href||o.$route.path==="/"&&a.href==="/"?"text-white":"text-gray-400 dark:text-gray-500 group-hover:text-black dark:group-hover:text-white","mr-3 flex-shrink-0 h-6 w-6"])},null,8,["class"])),z(" "+h(a.name),1)]),_:2},1032,["to","onClick","class"])),64))]),e("div",Ce,[e("button",{onClick:C,class:"w-full group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 transition-colors duration-200"},[g(s(me),{class:"mr-3 flex-shrink-0 h-6 w-6 text-gray-400 dark:text-gray-500 group-hover:text-red-600 dark:group-hover:text-red-400"}),d[2]||(d[2]=z(" Logout ",-1))])])])]),e("div",$e,[e("header",Me,[e("div",Ae,[e("div",null,[e("h2",Ne,h(q.value),1)]),e("div",De,[e("div",Se,[e("button",{onClick:d[0]||(d[0]=a=>f.value=!f.value),class:"p-2 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 relative"},[g(s(ge),{class:"h-6 w-6"}),s(i).unreadCount>0?(n(),l("span",Be,h(s(i).unreadCount>9?"9+":s(i).unreadCount),1)):p("",!0)]),f.value?(n(),l("div",Pe,[e("div",{class:"px-4 py-2 border-b border-gray-200 dark:border-gray-700"},[e("div",{class:"flex items-center justify-between"},[d[3]||(d[3]=e("h3",{class:"text-sm font-medium text-gray-900 dark:text-white"},"Notifications",-1)),e("button",{onClick:I,class:"text-xs text-primary-600 hover:text-primary-700"}," Mark all as read ")])]),s(i).notifications.length===0?(n(),l("div",Re," No notifications ")):(n(),l("div",je,[(n(!0),l(j,null,V(s(i).notifications,a=>(n(),l("div",{key:a.id,class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:S=>G(a)},[e("div",ze,[e("div",Le,[e("div",{class:w(["w-2 h-2 rounded-full mt-2",a.priority==="high"?"bg-red-500":"bg-blue-500"])},null,2)]),e("div",He,[e("p",Fe,h(a.title),1),e("p",Oe,h(a.message),1),e("p",Te,h(E(a.timestamp)),1)]),e("button",{onClick:Y(S=>b(a.id),["stop"]),class:"ml-2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-400"},[g(s(ie),{class:"h-4 w-4"})],8,qe)])],8,Ve))),128))]))])):p("",!0)]),e("div",Ee,[e("button",{onClick:d[1]||(d[1]=a=>x.value=!x.value),class:"flex items-center space-x-3 text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[g(oe,{src:(A=s(c).user)==null?void 0:A.avatar,name:((N=s(c).user)==null?void 0:N.name)||"Admin",size:"sm"},null,8,["src","name"]),e("span",Ge,h(((D=s(c).user)==null?void 0:D.name)||"Admin"),1)]),x.value?(n(),l("div",Ie,[e("button",{onClick:C,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}," Sign out ")])):p("",!0)])])])]),e("main",Je,[(n(),L(m,{key:o.$route.path}))])]),g(re,{show:s(F),title:s(k).title,message:s(k).message,"required-permissions":s(k).requiredPermissions,onGoBack:s(O),onContactAdmin:s(T)},null,8,["show","title","message","required-permissions","onGoBack","onContactAdmin"])])}}};export{ot as default};
